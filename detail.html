<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Personel Detay</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-dark bg-warning">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Vitamin Pastanesi</a>
  </div>
</nav>

<div class="container mt-5">
  <div id="detail" class="card p-4 shadow"></div>

  <hr>
  <h5>Personel Notu(CRM)</h5>
  <textarea id="noteArea" class="form-control mb-2"></textarea>
  <button class="btn btn-primary" onclick="saveNote()">Notu Kaydet</button>
  <p id="status" class="text-success mt-2"></p>

  <a href="index.html" class="btn btn-warning mt-3">← Geri</a>
</div>

<script src="js/api.js"></script>
<script>
const id = new URLSearchParams(window.location.search).get("id");

function renderDetail(e){
  detail.innerHTML = `
    <img src="${e.photo}" class="img-fluid rounded mb-3">
    <h3>${e.name}</h3>
    <span class="badge bg-primary">${e.role}</span>
  `;
  noteArea.value = localStorage.getItem("note_" + id) || "";
}

if (typeof fetchEmployees === 'function'){
  fetchEmployees(6).then(list => {
    const emp = list.find(x => x.id == id);
    if(emp) renderDetail(emp);
  }).catch(()=>{
    // fallback to local json
    fetch('data/employees.json').then(r=>r.json()).then(list=>{
      const emp = list.find(x => x.id == id);
      if(emp) renderDetail(emp);
    });
  });
} else {
  fetch('data/employees.json').then(r=>r.json()).then(list=>{
    const emp = list.find(x => x.id == id);
    if(emp) renderDetail(emp);
  });
}

function saveNote() {
  localStorage.setItem("note_" + id, noteArea.value);
  status.innerText = "Not kaydedildi ✅";
}
</script>
</body>
</html>
